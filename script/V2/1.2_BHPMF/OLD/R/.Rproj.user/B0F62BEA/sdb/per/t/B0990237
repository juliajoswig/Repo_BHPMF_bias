{
    "contents" : "###################\n# this script has to be run from the R directory of the dataset\n\n\nmessage(Sys.time(), \": Loading data\")\nsource(\"preprocess_cv.R\")\nX    <- as.matrix(read.table(\"../data/traitInfo.txt\", header = F, sep = \"\\t\"))[,-1]\nhier <-           read.table(\"../data/phyAllInfo.txt\",sep = \"\\t\")\n\nif(!file.exists(\"../data/output\")) dir.create(\"../data/output\")\n\nif  (typeof(X) != \"double\")     stop(\"X must be of type double\")\nif(class(hier) != \"data.frame\") stop(\"hier must be of class data.frame\")\nif    (nrow(X) != nrow(hier))   stop(\"hier and X must have the same number of rows\")\n\n\nback_trans_funs <- list()\n# transform data:\n# make a robust logz transforation\nrm_col <- c()\nfor(i in 1:ncol(X)){\n  x <- X[,i]\n  minx <- min(x)\n  x_rng <- quantile(x,probs = c(.1,.9))\n  x[ x < x_rng[1] | x > x_rng[2] ] <- NA # make it robust, ie remove tails\n\n  # if there are no negative values take logarithm first and then z-transform\n  # this should be the case for all variables, except Leaf_nitrogen_phosphorus_N_P_ratio\n  if(minx > 0){ \n    logx <- log(x)\n    mlogx <- mean(logx, na.rm = T)\n    slogx <- sd(logx, na.rm = T)\n    back_trans_pars[[i]] <- (function(s,m) function(x) exp(x*s + m))(slogx,mlogx)\n    X[,i] <- (log(X[,i]) - mlogx) / slogx\n    # if there are negative values do only z-transformation\n    # this should be the case only for Leaf_nitrogen_phosphorus_N_P_ratio\n  } else { \n    m <- mean(x, na.rm = T)\n    s <- sd(x, na.rm = T)\n    back_trans_funs[[i]] <- (function(s,j) function(x) x*s + m)(s,m)\n    X[,i] <- (X[,i] - m) / s\n  }\n}\n\nsave(back_trans_funs, file = \"../data/output/back_trans_funs.RData\")\n\ntmp_dir = \"../data\"\nmessage(\"Intermediate results are saved in: \", tmp_dir)\n\nmessage(Sys.time(), \": Starting PreprocessCv()\")\n\nPreprocessCv(X, \n             hier, \n             num.folds = 5, \n             tmp.dir   = tmp_dir)\n\n \nmessage(Sys.time(), \": DONE\")\n\n\n\n\n",
    "created" : 1439195692054.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1586920516",
    "id" : "B0990237",
    "lastKnownWriteTime" : 1441008751,
    "path" : "M:/projects/FDiversity/hierarchy/hpmf_method_paper/scripts/HPMF_v1.6/R/preprocess.R",
    "project_path" : "preprocess.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}