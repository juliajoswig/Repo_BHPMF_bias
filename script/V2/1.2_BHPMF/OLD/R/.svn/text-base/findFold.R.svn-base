findFolds <- function(zsLogTrain, numFolds, filename, treeFile, permuteFile, inputDir, secondCV, traitNames, testFlag, level){

	cat("start\n")
    if(nchar(permuteFile) != 0){
		all = as.matrix(sparseMatrix(zsLogTrain[, 1], zsLogTrain[, 2], x = zsLogTrain[, 3]));
	}
	else {
		all = zsLogTrain;
    }
    

    cat("count\n")
    res <- countNumTraits(all, 0);
    noTraits <- res[[1]];
    indObs <- res[[2]];
    traitIds <- res[[3]];
    rm(res)


	cat("permute\n")
    res <- generatePermutation(noTraits, traitIds, numFolds, testFlag);
    permutMatTest <- res[[1]];
	permutMatV <- res[[2]];
    rm(res)
    
    
    cat("split\n")
    res <- splitData(permutMatTest, permutMatV, noTraits, all, all, traitNames, filename, treeFile, inputDir, secondCV, testFlag, level);
                    
    indValid = res[[1]];
    indTest = res[[2]];
    indTrain = res[[3]];
    rm(res);

	if(nchar(permuteFile) != 0)
	    save(file = permuteFile, permutMatTest, permutMatV, indValid, indTest, indTrain)
    
}
